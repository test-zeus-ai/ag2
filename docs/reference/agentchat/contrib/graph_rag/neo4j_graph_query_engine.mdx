---
sidebarTitle: neo4j_graph_query_engine
title: agentchat.contrib.graph_rag.neo4j_graph_query_engine
---

## Neo4jGraphQueryEngine

```python
class Neo4jGraphQueryEngine(GraphQueryEngine)
```

This class serves as a wrapper for a property graph query engine backed by LlamaIndex and Neo4j,
facilitating the creating, connecting, updating, and querying of LlamaIndex property graphs.

It builds a property graph Index from input documents,
storing and retrieving data from the property graph in the Neo4j database.

It extracts triplets, i.e., [entity] -> [relationship] -> [entity] sets,
from the input documents using llamIndex extractors.

Users can provide custom entities, relationships, and schema to guide the extraction process.

If strict is True, the engine will extract triplets following the schema
of allowed relationships for each entity specified in the schema.

It also leverages LlamaIndex's chat engine which has a conversation history internally to provide context-aware responses.

For usage, please refer to example notebook/agentchat_graph_rag_neo4j.ipynb

### \_\_init\_\_

```python
def __init__(host: str = "bolt://localhost",
             port: int = 7687,
             database: str = "neo4j",
             username: str = "neo4j",
             password: str = "neo4j",
             llm: LLM = OpenAI(model="gpt-4o", temperature=0.0),
             embedding: BaseEmbedding = OpenAIEmbedding(
                 model_name="text-embedding-3-small"),
             entities: Optional[TypeAlias] = None,
             relations: Optional[TypeAlias] = None,
             schema: Optional[Union[dict[str, str], list[Triple]]] = None,
             strict: Optional[bool] = False)
```

Initialize a Neo4j Property graph.
Please also refer to https://docs.llamaindex.ai/en/stable/examples/property_graph/graph_store/

**Arguments**:

- `name` _str_ - Property graph name.
- `host` _str_ - Neo4j hostname.
- `port` _int_ - Neo4j port number.
- `database` _str_ - Neo4j database name.
- `username` _str_ - Neo4j username.
- `password` _str_ - Neo4j password.
- `llm` _LLM_ - Language model to use for extracting triplets.
- `embedding` _BaseEmbedding_ - Embedding model to use constructing index and query
- `entities` _Optional[TypeAlias]_ - Custom suggested entities to include in the graph.
- `relations` _Optional[TypeAlias]_ - Custom suggested relations to include in the graph.
- `schema` _Optional[Union[Dict[str, str], List[Triple]]_ - Custom schema to specify allowed relationships for each entity.
- `strict` _Optional[bool]_ - If false, allows for values outside of the input schema.

### init\_db

```python
def init_db(input_doc: list[Document] | None = None)
```

Build the knowledge graph with input documents.

### connect\_db

```python
def connect_db()
```

Connect to an existing knowledge graph database.

### add\_records

```python
def add_records(new_records: list) -> bool
```

Add new records to the knowledge graph. Must be local files.

**Arguments**:

- `new_records` _List[Document]_ - List of new documents to add.
  

**Returns**:

- `bool` - True if successful, False otherwise.

### query

```python
def query(question: str,
          n_results: int = 1,
          **kwargs) -> GraphStoreQueryResult
```

Query the property graph with a question using LlamaIndex chat engine.
We use the condense_plus_context chat mode
which condenses the conversation history and the user query into a standalone question,
and then build a context for the standadlone question
from the property graph to generate a response.

**Arguments**:

- `question` - a human input question.
- `n_results` - number of results to return.
  

**Returns**:

  A GrapStoreQueryResult object containing the answer and related triplets.

